MPASM 02.70 Released         STEPPE~2.ASM   2-7-2010  12:57:44         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;UCNC Router Stepper Control;;;;;;;;;;;;;;;;;
                      00002 ;INPUTS:                                                                        ;
                      00003 ;PIN 6  => RB0 => Step Pulse                            ;
                      00004 ;PIN 7  => RB1 => Forward/Reverse signal        ;
                      00005 ;OUTPUTS:                                                                       ;
                      00006 ;PIN 11 => RB5 => A Coil                                        ;
                      00007 ;PIN 10 => RB4 => A* Coil                                       ;
                      00008 ;PIN 9  => RB3 => B Coil                                        ;
                      00009 ;PIN 8  => RB2 => B* Coil                                       ;
                      00010 ;PIN 13 => RB7 => Enable A Coil                         ;
                      00011 ;PIN 12 => RB6 => Enable B Coil                         ;
                      00012 ;PIN 2  => RA3 => Busy                                          ;
                      00013 ;                                                                                       ;
                      00014 ;Program waits for the rising edge of a         ;
                      00015 ; signal on RB0 to trigger an interrupt         ;
                      00016 ; and initiate a step.                                          ;
                      00017 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      00018 
                      00019 ;Constants
  00000003            00020 STATUS  equ 03h
  00000005            00021 RP0             equ 05h
  00000005            00022 PORTA   equ 05h
  00000006            00023 PORTB   equ 06h
  0000000B            00024 INTCON  equ 0Bh
  0000000C            00025 STATE   equ 0Ch
  00000081            00026 OPT             equ 81h
  00000085            00027 TRISA   equ 85h
  00000086            00028 TRISB   equ 86h
                      00029 
Warning[205]: Found directive in column 1. (ORG)
0000                  00030 ORG 0000h
Warning[203]: Found opcode in column 1. (GOTO)
0000   2807           00031 GOTO STARTUP    ;Skip interrupt
Warning[205]: Found directive in column 1. (ORG)
0004                  00032 ORG 0004h               ;Interrupt memory location
Warning[203]: Found opcode in column 1. (CALL)
0004   2015           00033 CALL STEP               ;Call STEP subroutine
Warning[203]: Found opcode in column 1. (BCF)
0005   108B           00034 BCF INTCON,1    ;Clear Interrupt
Warning[203]: Found opcode in column 1. (RETFIE)
0006   0009           00035 RETFIE                  ;Return from interrupt
                      00036 
                      00037 ;Startup        5.2 u seconds
0007   1283           00038 STARTUP BCF STATUS,RP0  ;Bank 0
0008   0185           00039                 CLRF PORTA              ;Init PORTA
0009   0186           00040                 CLRF PORTB              ;Init PORTB
000A   1683           00041                 BSF STATUS,RP0  ;Bank 1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000B   1701           00042                 BSF OPT,6               ;Enable Interrupt on rising edge
000C   3003           00043                 MOVLW 03h               ;Set RB0-1 as inputs, RB2-7 as outputs
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000D   0086           00044                 MOVWF TRISB             ;Setup RC0-5 as outputs
000E   1283           00045                 BCF STATUS,RP0  ;Bank 0
MPASM 02.70 Released         STEPPE~2.ASM   2-7-2010  12:57:44         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000F   178B           00046                 BSF     INTCON,7        ;Enable Global Interrupts
0010   160B           00047                 BSF     INTCON,4        ;Enable RB0 Interrupt
0011   30C0           00048                 MOVLW 0xC0              ;Set Enable outputs (RB6-7)
0012   0086           00049                 MOVWF PORTB             ;Output Enable bits for H-Bridge
                      00050                 
0013   202C           00051                 CALL STEP1              ;Start the system at STEP1
                      00052 
                      00053 ;Worst case step takes 5 u seconds
                      00054 ;Listen for step instruction
0014                  00055 LISTEN
0014   2814           00056                 GOTO LISTEN             ;Continue listening until interrupt
                      00057 
0015                  00058 STEP
0015   1886           00059                 BTFSC PORTB,1   ;If PORTB, bit 1 is 0 skip next line
0016   201A           00060                 CALL FORWARD    ;Step Forward
0017   1C86           00061                 BTFSS PORTB,1   ;If PORTB, bit 1 is 1 skip next line
0018   2023           00062                 CALL REVERSE    ;Step in Reverse
0019   0008           00063                 RETURN                  ;GOTO LISTEN
                      00064 
001A                  00065 FORWARD
001A   188C           00066                 BTFSC STATE,1   ;If W, bit 0 is 0 skip next line
001B   2832           00067                 GOTO STEP2              ;Next step(2)
001C   190C           00068                 BTFSC STATE,2   ;If STATE, bit 1 is 0 skip next line
001D   2838           00069                 GOTO STEP3              ;Next step(3)
001E   198C           00070                 BTFSC STATE,3   ;If STATE, bit 2 is 0 skip next line
001F   283E           00071                 GOTO STEP4              ;Next step(4)
0020   1A0C           00072                 BTFSC STATE,4   ;If STATE, bit 3 is 0 skip next line
0021   282C           00073                 GOTO STEP1              ;Next step(1)
0022   0008           00074                 RETURN                  ;GOTO LISTEN
                      00075 
0023                  00076 REVERSE
0023   1A0C           00077                 BTFSC STATE,4           ;If STATE, bit 3 is 0 skip next line
0024   2838           00078                 GOTO STEP3              ;Next step(3)
0025   198C           00079                 BTFSC STATE,3           ;If STATE, bit 2 is 0 skip next line
0026   2832           00080                 GOTO STEP2              ;Next step(2)
0027   190C           00081                 BTFSC STATE,2           ;If STATE, bit 1 is 0 skip next line
0028   282C           00082                 GOTO STEP1              ;Next step(1)
0029   188C           00083                 BTFSC STATE,1           ;If STATE, bit 0 is 0 skip next line
002A   283E           00084                 GOTO STEP4              ;Next step(4)
002B   0008           00085                 RETURN                  ;GOTO LISTEN
                      00086                 
                      00087 ;Power to Step 1
002C   30E8           00088 STEP1   MOVLW 0xE8              ;Setup Step1 output(1110 1000)
002D   0086           00089                 MOVWF PORTB             ;Output Step1 to PORTB
002E   120C           00090                 BCF STATE,4             ;Reset STATE
002F   148C           00091                 BSF STATE,1             ;Set STATE to 0001 to track steps
0030   110C           00092                 BCF STATE,2             ;Reset STATE
0031   0008           00093                 RETURN                  ;GOTO LISTEN
                      00094 ;Power to Step 2
0032   30E4           00095 STEP2   MOVLW 0xE4              ;Setup Step1 output(1110 0100)
0033   0086           00096                 MOVWF PORTB             ;Output Step2 to PORTB
0034   108C           00097                 BCF STATE,1             ;Reset STATE
0035   150C           00098                 BSF STATE,2             ;Set W to 0010 to track steps
MPASM 02.70 Released         STEPPE~2.ASM   2-7-2010  12:57:44         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0036   118C           00099                 BCF STATE,3             ;Reset STATE
0037   0008           00100                 RETURN                  ;GOTO LISTEN
                      00101 ;Power to Step 3
0038   30D4           00102 STEP3   MOVLW 0xD4              ;Setup Step1 output(1101 0100)
0039   0086           00103                 MOVWF PORTB             ;Output Step2 to PORTB
003A   110C           00104                 BCF STATE,2             ;Reset STATE
003B   158C           00105                 BSF STATE,3             ;Set W to 0100 to track steps
003C   120C           00106                 BCF STATE,4             ;Reset STATE
003D   0008           00107                 RETURN                  ;GOTO LISTEN
                      00108 ;Power to Step 4
003E   30D8           00109 STEP4   MOVLW 0xD8              ;Setup Step1 output(1101 1000)
003F   0086           00110                 MOVWF PORTB             ;Output Step2 to PORTB
0040   118C           00111                 BCF STATE,3             ;Reset STATE
0041   160C           00112                 BSF STATE,4             ;Set W to 1000 to track steps
0042   108C           00113                 BCF STATE,1             ;Reset STATE
0043   0008           00114                 RETURN                  ;GOTO LISTEN
Warning[205]: Found directive in column 1. (END)
                      00115 END
MPASM 02.70 Released         STEPPE~2.ASM   2-7-2010  12:57:44         PAGE  4


SYMBOL TABLE
  LABEL                             VALUE 

FORWARD                           0000001A
INTCON                            0000000B
LISTEN                            00000014
OPT                               00000081
PORTA                             00000005
PORTB                             00000006
REVERSE                           00000023
RP0                               00000005
STARTUP                           00000007
STATE                             0000000C
STATUS                            00000003
STEP                              00000015
STEP1                             0000002C
STEP2                             00000032
STEP3                             00000038
STEP4                             0000003E
TRISA                             00000085
TRISB                             00000086
__16F84A                          00000001


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXX------------ ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:    65
Program Memory Words Free:   959


Errors   :     0
Warnings :     7 reported,     0 suppressed
Messages :     2 reported,     0 suppressed

